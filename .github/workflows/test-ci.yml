name: CI/CD Testing for AutentiseringApp

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: macos-latest

    steps:
      - name: ğŸš€ Sjekk ut repository
        uses: actions/checkout@v3

      - name: ğŸ›  Sett opp Swift-miljÃ¸
        run: |
          sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer
          swift --version

      - name: ğŸ“¦ Installer avhengigheter
        run: swift package update

      - name: âœ… KjÃ¸r enhetstester for autentisering
        run: swift test --filter AuthenticationManagerTests

      - name: âœ… Test CloudKit-synkronisering
        run: swift test --filter CloudKitTests

      - name: âœ… Test Docker-container
        run: docker build -t autentisering-app .

      - name: ğŸ“¤ Send Slack-varsler ved feil
        if: failure()
        run: sh Scripts/slack_notify.sh
